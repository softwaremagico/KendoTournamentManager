<app-mat-spinner-overlay [overlay]="true"></app-mat-spinner-overlay>
<h1 mat-dialog-title>{{ title }}</h1>
<div class="form-layout" mat-dialog-content>
  <form (ngSubmit)="doAction()" [formGroup]="registerForm">
    <mat-form-field *ngIf="actionName != 'Delete'">
      <mat-label>{{ 'tournamentType' | transloco }}</mat-label>
      <mat-select [(value)]="tournament.type" formControlName="tournamentType">
        <mat-option (click)="select(type)" (keydown)="select(type)" *ngFor="let type of tournamentType" [value]="type"
                    [matTooltipShowDelay]="500" matTooltip="{{getTournamentTypeHintTag(type) | transloco}}">
          {{ getTournamentTypeTranslationTag(type) | transloco }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <div class="types">
      <mat-form-field *ngIf="actionName != 'Delete'; else elseTemplate">
        <input [readonly]="!rbacService.isAllowed(RbacActivity.EDIT_TOURNAMENT)"
               formControlName="tournamentName"
               matInput
               placeholder="{{'competitionName' | transloco}}"
               required>
      </mat-form-field>
      <button *ngIf="actionName != 'Delete'" (click)="openCustomProperties()" class="edit-score-button"
              [disabled]="tournament.id==undefined || tournament.type == typeCustom"
              color="primary" mat-flat-button
              mat-raised-button
              type="button">
        <mat-icon>settings</mat-icon>
      </button>
    </div>
    <mat-form-field *ngIf="actionName != 'Delete'">
      <input [readonly]="!rbacService.isAllowed(RbacActivity.EDIT_TOURNAMENT) || selectedType == typeLoop
          || this.selectedType == typeLeague || this.selectedType == typeKing || this.selectedType == typeSorting"
             formControlName="shiaijos" matInput
             placeholder="{{'tournamentShiaijos' | transloco}}"
             required>
    </mat-form-field>
    <mat-form-field *ngIf="actionName != 'Delete'  && tournament && tournament.type!== TournamentType.SENBATSU">
      <input [readonly]="!rbacService.isAllowed(RbacActivity.EDIT_TOURNAMENT)" formControlName="teamSize" matInput
             placeholder="{{'tournamentTeamSize' | transloco}}">
    </mat-form-field>
    <div class="types">
      <mat-form-field
        *ngIf="actionName != 'Delete' && tournament && tournament.type!== TournamentType.BUBBLE_SORT && tournament.type!== TournamentType.SENBATSU">
        <mat-label>{{ 'scoreRules' | transloco }}</mat-label>
        <mat-select [(value)]="tournament.tournamentScore.scoreType" [matTooltipShowDelay]="1000"
                    formControlName="scoreTypes"
                    matTooltip="{{tournament.tournamentScore.scoreType.toLowerCase()+'Hint' | transloco}}">
          <mat-option *ngFor="let type of scoreTypes" [matTooltipShowDelay]="1000"
                      (click)="selectScore(type)" (keydown)="selectScore(type)"
                      [value]="type" matTooltip="{{type.toLowerCase()+'Hint' | transloco}}">
            {{ type.toLowerCase() | transloco }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button (click)="openScoreDefinition()" *ngIf="selectedScore==scoreTypeCustom" class="edit-score-button"
              color="primary" mat-flat-button
              mat-raised-button
              type="button">
        <mat-icon>edit</mat-icon>
      </button>
    </div>
    <mat-form-field *ngIf="actionName != 'Delete'">
      <mat-label>{{ 'tournamentDuelsDurations' | transloco }}</mat-label>
      <mat-select [(value)]="tournament.duelsDuration" formControlName="duelsDuration">
        <mat-option *ngFor="let number of [30, 60, 90, 120, 150, 180, 240, 300, 360, 420, 480, 540, 600]"
                    [value]="number">
          {{ number }} {{ 'seconds' | transloco }}
          ({{ getMinutes(number) }} {{ 'minutes' | transloco }} {{ getSeconds(number) }} {{ 'seconds' | transloco }})
        </mat-option>
      </mat-select>
    </mat-form-field>
    <ng-template #elseTemplate>
      <span [innerHTML]="'tournamentDeleteQuestion' | transloco : {name: tournament.name}"></span>
    </ng-template>

    <div class="button-container" mat-dialog-actions>
      <button (click)="addPicture()"
              *ngIf="actionName == 'Update' && (RbacActivity.SEE_PICTURE | hasPermission)"
              color="picture"
              mat-flat-button
              mat-raised-button
              type="button">
        <mat-icon>image</mat-icon>
        {{ 'images' | transloco }}
      </button>
      <button *ngIf="(RbacActivity.EDIT_TOURNAMENT | hasPermission)"
              [disabled]="registerForm.invalid" color="primary"
              mat-flat-button mat-raised-button
              type="submit" value="Submit">
        <mat-icon>done</mat-icon>
        {{ actionName.toLowerCase() | transloco }}
      </button>
      <button (click)="closeDialog(cancel)" color="warn" mat-flat-button mat-raised-button
              type="button">{{ 'cancel' | transloco }}
      </button>
    </div>
  </form>
</div>
