<ng-container *transloco="let t">
  <div class="table-view">
    <biit-datatable #table id="participants-table"
                    [columns]="columns"
                    [data]="participants"
                    [pageSize]="pageSize"
                    [pageSizeList]="pageSizes"
                    [loading]="loading"
                    scrollbarH
                    selectable
    >
      <ng-template #actions>
        <button id="button-plus" biit-icon icon="plus" *ngIf="RbacActivity.CREATE_PARTICIPANT | hasPermission"
                [title]="t('participantAdd')"
                (click)="addElement()"
        ></button>
        <button id="button-minus" biit-icon icon="minus" class="warning"
                *ngIf="RbacActivity.DELETE_PARTICIPANT | hasPermission"
                [title]="t('delete')"
                (click)="confirmDelete=true"
                [disabled]="!table.selectedRows.length"
        ></button>
        <button id="button-edit" biit-icon icon="edit" *ngIf="RbacActivity.READ_ONE_PARTICIPANT | hasPermission"
                [title]="t('participantEdit')"
                (click)="editElement(table.selectedRows[0])"
                [disabled]="!table.selectedRows || table.selectedRows.length != 1 || table.selectedRows[0].locked"
        ></button>
        <button id="button-camera" biit-icon icon="camera" *ngIf="RbacActivity.READ_ONE_PARTICIPANT | hasPermission"
                [title]="t('photo')"
                (click)="addPhoto=true"
                [disabled]="!table.selectedRows || table.selectedRows.length != 1 || table.selectedRows[0].locked"
        ></button>
        <mat-divider [vertical]="true"></mat-divider>
        <button mat-button *ngIf="(RbacActivity.VIEW_PARTICIPANT_STATISTICS | hasPermission)"
                [title]="t('titleStatistics')"
                (click)="openStatistics(table.selectedRows[0])"
                [disabled]="!table.selectedRows ||  table.selectedRows.length != 1">
          <mat-icon class="kendo-icon" svgIcon="bar_chart"></mat-icon>
        </button>
        <mat-divider [vertical]="true" class="extra-menu"></mat-divider>
        <span class="extra-menu">
          <button mat-button *ngIf="(RbacActivity.READ_ALL_COMPETITORS_RANKINGS | hasPermission)"
                  [title]="t('competitorsRanking')"
                  (click)="showRanking=true">
            <mat-icon class="kendo-icon" svgIcon="competitors-classification"></mat-icon>
          </button>
          <button mat-button *ngIf="(RbacActivity.SEE_QR_CODE | hasPermission)"
                  [title]="t('qrCodeHint')"
                  (click)="showQr=true"
                  [disabled]="!table.selectedRows ||  table.selectedRows.length != 1">
          <mat-icon class="kendo-icon" svgIcon="qr_code"></mat-icon>
          </button>
        </span>
      </ng-template>
    </biit-datatable>
  </div>

  <participant-form-popup *ngIf="target"
                          [participant]="target"
                          (onClosed)="this.target = null"
                          (onSaved)="onSaved($event)"
  />

  <biit-popup id="confirmation-delete-popup" *ngIf="confirmDelete"
              no-header
  >
    <div class="vertical">
      <span
        [innerHTML]="'tournamentDeleteQuestion' | transloco : {name: getParticipantNames(table.selectedRows)}"></span>
      <div class="flex-grow horizontal buttons-row">
        <button id="confirm-cancel-button" biit-button secondary (click)="confirmDelete = false">{{ t('cancel') }}
        </button>
        <button id="confirm-delete-button" biit-button primary
                (click)="deleteElements(table.selectedRows)">{{ t('delete') }}
        </button>
      </div>
    </div>
  </biit-popup>

  <biit-popup id="qr-code-popup" *ngIf="showQr" no-header>
    <participant-qr-code
      [participant]="table.selectedRows[0]"
      [port]="port"
      (onClosed)="showQr=false"></participant-qr-code>
  </biit-popup>


  <biit-popup id="ranking-popup" *ngIf="showRanking" no-header>
    <competitors-ranking
      [competitor]="table.selectedRows[0]"
      [showIndex]="true"
      (onClosed)="showRanking=false"></competitors-ranking>
  </biit-popup>

  <biit-popup id="photo-popup" *ngIf="addPhoto" no-header>
    <participant-picture
      [participant]="table.selectedRows[0]"
      (onClosed)="addPhoto=false"></participant-picture>
  </biit-popup>
</ng-container>
